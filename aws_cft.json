{
	"AWSTemplateFormatVersion": "2010-09-09",
	"Description" : "AWS CloudFormation Template for an Amazon EC2 instance.",
	"Parameters" : {

		"KeyName" : {
			"Description" : "Name of an existing EC2 KeyPair to enable SSH access to the instance",
			"Type": "String",
            "MinLength": "1",
            "MaxLength": "64",
            "Default": "testkey",
            "AllowedPattern": "[-_ a-zA-Z0-9]*",
            "ConstraintDescription": "can contain only alphanumeric characters, spaces, dashes and underscores."

		},

		"InstanceType" : {
			"Description" : "GPU instance type",
			"Type" : "String",
			"Default" : "g2.2xlarge",
			"AllowedValues" : ["g2.2xlarge"],
			"ConstraintDescription" : "Must be a valid EC2 instance type"
		},

		"UbuntuAMIID" : {
			"Type" : "String",
			"Default" : "ami-73208813",
			"Description" : "The AMIID of Ubuntu Instance."
		},

		"SSHLocation" : {
      		"Description" : "The IP address range that can be used to SSH to the EC2 instances",
      		"Type" : "String",
      		"MinLength" : "9",
      		"MaxLength" : "18",
      		"Default" : "0.0.0.0/0",
      		"AllowedPattern" : "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
      		"ConstraintDescription" : "Must be a valid IP CIDR range of the form x.x.x.x/x"
    	},

    	"VolumeSize" : {
      		"Description" : "The size of the EBS volume to attach",
      		"Type" : "Number",
      		"Default" : "10"
    	}
	},

	"Mappings" : {
		"AWSInstanceType2Arch" : {
			"g2.2xlarge" : { "Arch" : "HVM64"}
		},

		"AWSRegionArch2AMI" : {
			"us-west-2" : {
				"HVM64" : "ami-73208813"
			}
		}
	},

	"Resources" : {

	    "EC2Instance": {
	     	"Type": "AWS::EC2::Instance",
	      	"Properties": {
	        "ImageId" : { "Fn::FindInMap" : [ "AWSRegionArch2AMI", { "Ref" : "AWS::Region" },
	                          { "Fn::FindInMap" : [ "AWSInstanceType2Arch", { "Ref" : "InstanceType" }, "Arch" ] } ] },
	        "InstanceType"   : { "Ref" : "InstanceType" },
	        "SecurityGroups" : [ {"Ref" : "EC2SecurityGroup"} ],
	        "KeyName"        : { "Ref" : "KeyName" },
	        "BlockDeviceMappings" : [{"DeviceName" : "/dev/sda1", "Ebs" : {"VolumeSize" : "100", "VolumeType" : "gp2"}}]}
	    },

	    "EC2SecurityGroup" : {
	      	"Type" : "AWS::EC2::SecurityGroup",
	      	"Properties" : {
	        "GroupDescription" : "Enable HTTP access via port 80",
	        "SecurityGroupIngress" : [
	        	{"IpProtocol" : "tcp", "FromPort" : "80", "ToPort" : "80", "CidrIp" : "0.0.0.0/0"},
	          	{"IpProtocol" : "tcp", "FromPort" : "22", "ToPort" : "22", "CidrIp" : { "Ref" : "SSHLocation"}}]
	      	}
	    }
  	}
}
